<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prompt Recorder</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 30px; }
    #prompt { font-size: 24px; margin-bottom: 20px; }
    #videoPreview {
      width: 480px;
      height: 360px;
      margin: 20px auto;
      border: 2px solid #ccc;
      display: block;
    }
    #downloadLink, #stopButton {
      margin-top: 20px;
      display: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="prompt">Get ready...</div>
  <video id="videoPreview" autoplay muted playsinline></video>
  <p id="status">Preparing to record...</p>
  <button id="stopButton">Stop Recording</button>
  <br>
  <a id="downloadLink" href="#" download="recording.webm">Download your recording</a>

  <script>
    const prompts = [
      "Describe your perfect day.",
      "What motivates you every morning?",
      "Talk about a childhood memory.",
      "What’s something new you’ve learned recently?",
      "Tell a story that made you laugh."
    ];

    const promptDisplay = document.getElementById('prompt');
    const videoPreview = document.getElementById('videoPreview');
    const statusDisplay = document.getElementById('status');
    const downloadLink = document.getElementById('downloadLink');
    const stopButton = document.getElementById('stopButton');

    const RECORDING_DURATION = 60000; // 60 seconds
    const COUNTDOWN_SECONDS = 3;      // Countdown before recording

    let mediaRecorder;
    let mediaStream;
    let chunks = [];
    let recordingTimeout;

    const selectedPrompt = prompts[Math.floor(Math.random() * prompts.length)];
    promptDisplay.textContent = selectedPrompt;

    function startCountdown(seconds) {
      if (seconds > 0) {
        statusDisplay.textContent = `Recording starts in ${seconds}...`;
        setTimeout(() => startCountdown(seconds - 1), 1000);
      } else {
        startRecording();
      }
    }

    function startRecording() {
      navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
        mediaStream = stream;
        videoPreview.srcObject = stream;

        mediaRecorder = new MediaRecorder(stream);
        chunks = [];

        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'video/webm' });
          const url = URL.createObjectURL(blob);
          downloadLink.href = url;
          downloadLink.style.display = 'inline';
          stopButton.style.display = 'none';
          statusDisplay.textContent = "Recording finished!";
          stream.getTracks().forEach(track => track.stop());
        };

        statusDisplay.textContent = "Recording started...";
        mediaRecorder.start();
        stopButton.style.display = 'inline';

        // Automatically stop after time limit
        recordingTimeout = setTimeout(() => {
          stopRecording();
        }, RECORDING_DURATION);
      }).catch(error => {
        statusDisplay.textContent = "Error accessing camera/mic.";
        console.error(error);
      });
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        clearTimeout(recordingTimeout);
      }
    }

    stopButton.addEventListener('click', stopRecording);

    startCountdown(COUNTDOWN_SECONDS);
  </script>
</body>
</html>
